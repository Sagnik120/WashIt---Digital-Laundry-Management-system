{
  "openapi": "3.0.0",
  "info": { "title": "Laundry Management API", "version": "1.0.0" },
  "servers": [{ "url": "/" }],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "Error": {
        "type": "object",
        "properties": {
          "message": { "type": "string" },
          "code": { "type": "string" },
          "details": { "type": "object" }
        }
      }
    }
  },
  "security": [{ "bearerAuth": [] }],
  "paths": {
    "/api/auth/register/student": {
      "post": {
        "summary": "Register student",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "fullName",
                  "rollNumber",
                  "email",
                  "hostelCode",
                  "roomNo",
                  "password"
                ],
                "properties": {
                  "fullName": { "type": "string" },
                  "rollNumber": { "type": "string" },
                  "email": { "type": "string", "format": "email" },
                  "hostelCode": { "type": "string" },
                  "roomNo": { "type": "string" },
                  "password": { "type": "string", "minLength": 6 }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Registered. Verify email." },
          "400": { "description": "Invalid" }
        }
      }
    },
    "/api/auth/register/staff": {
      "post": {
        "summary": "Register staff",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["fullName", "email", "staffCode", "password"],
                "properties": {
                  "fullName": { "type": "string" },
                  "email": { "type": "string", "format": "email" },
                  "staffCode": { "type": "string" },
                  "password": { "type": "string", "minLength": 6 }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Registered. Verify email." },
          "400": { "description": "Invalid" }
        }
      }
    },
    "/api/auth/verify-email": {
      "post": {
        "summary": "Verify email OTP",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["email", "otp"],
                "properties": {
                  "email": { "type": "string", "format": "email" },
                  "otp": { "type": "string", "minLength": 6, "maxLength": 6 }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Email verified" },
          "400": { "description": "Invalid/expired OTP" }
        }
      }
    },
    "/api/auth/resend-otp": {
      "post": {
        "summary": "Resend OTP",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["email"],
                "properties": {
                  "email": { "type": "string", "format": "email" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "OTP sent" },
          "404": { "description": "User not found" }
        }
      }
    },
    "/api/auth/login": {
      "post": {
        "summary": "Login",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["email", "password"],
                "properties": {
                  "email": { "type": "string", "format": "email" },
                  "password": { "type": "string" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "JWT token" },
          "400": { "description": "Invalid credentials" }
        }
      }
    },
    "/api/auth/forgot-password": {
      "post": {
        "summary": "Forgot password",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["email"],
                "properties": {
                  "email": { "type": "string", "format": "email" }
                }
              }
            }
          }
        },
        "responses": { "200": { "description": "Temporary password sent" } }
      }
    },
    "/api/auth/change-password": {
      "post": {
        "summary": "Change password",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["oldPassword", "newPassword"],
                "properties": {
                  "oldPassword": { "type": "string" },
                  "newPassword": { "type": "string", "minLength": 6 }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Password changed" },
          "400": { "description": "Old password incorrect" }
        }
      }
    },

    "/api/me": {
      "get": {
        "summary": "Get current user",
        "responses": { "200": { "description": "User object" } }
      },
      "put": {
        "summary": "Update profile",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "fullName": { "type": "string" },
                  "phone": { "type": "string" },
                  "passingYear": { "type": "integer" },
                  "roomNo": { "type": "string" },
                  "profileImageUrl": { "type": "string" }
                }
              }
            }
          }
        },
        "responses": { "200": { "description": "Updated" } }
      }
    },

    "/api/admin/hostels": {
      "post": {
        "summary": "Create hostel",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["hostelName", "hostelCode", "status"],
                "properties": {
                  "hostelName": { "type": "string" },
                  "hostelCode": { "type": "string" },
                  "status": { "type": "string", "enum": ["ACTIVE", "INACTIVE"] }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Hostel" },
          "409": { "description": "hostelCode exists" }
        }
      },
      "get": {
        "summary": "List hostels",
        "security": [],
        "parameters": [
          {
            "name": "status",
            "in": "query",
            "schema": { "type": "string", "enum": ["ACTIVE", "INACTIVE"] }
          }
        ],
        "responses": { "200": { "description": "Hostels" } }
      }
    },
    "/api/admin/hostels/{id}": {
      "put": {
        "summary": "Update hostel",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["hostelName", "hostelCode", "status"],
                "properties": {
                  "hostelName": { "type": "string" },
                  "hostelCode": { "type": "string" },
                  "status": { "type": "string", "enum": ["ACTIVE", "INACTIVE"] }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Hostel" },
          "404": { "description": "Not found" },
          "409": { "description": "hostelCode exists" }
        }
      },
      "delete": {
        "summary": "Delete hostel",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Deleted" },
          "404": { "description": "Not found" },
          "409": { "description": "In use" }
        }
      }
    },

    "/api/admin/staff-codes": {
      "post": {
        "summary": "Create staff code",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["code", "status"],
                "properties": {
                  "code": { "type": "string" },
                  "staffNameHint": { "type": "string" },
                  "status": { "type": "string", "enum": ["ACTIVE", "INACTIVE"] }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "StaffCode" },
          "409": { "description": "code exists" }
        }
      },
      "get": {
        "summary": "List staff codes",
        "parameters": [
          {
            "name": "status",
            "in": "query",
            "schema": { "type": "string", "enum": ["ACTIVE", "INACTIVE"] }
          },
          { "name": "claimed", "in": "query", "schema": { "type": "boolean" } }
        ],
        "responses": { "200": { "description": "Staff codes" } }
      }
    },
    "/api/admin/staff-codes/{code}": {
      "put": {
        "summary": "Update staff code",
        "parameters": [
          {
            "name": "code",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["code", "status"],
                "properties": {
                  "code": { "type": "string" },
                  "staffNameHint": { "type": "string" },
                  "status": { "type": "string", "enum": ["ACTIVE", "INACTIVE"] }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "StaffCode" },
          "404": { "description": "Not found" }
        }
      },
      "delete": {
        "summary": "Delete staff code",
        "parameters": [
          {
            "name": "code",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Deleted" },
          "404": { "description": "Not found" },
          "409": { "description": "In use" }
        }
      }
    },

    "/api/admin/students": {
      "get": {
        "summary": "List students",
        "parameters": [
          {
            "name": "hostelCode",
            "in": "query",
            "schema": { "type": "string" }
          },
          { "name": "q", "in": "query", "schema": { "type": "string" } },
          { "name": "page", "in": "query", "schema": { "type": "integer" } },
          {
            "name": "pageSize",
            "in": "query",
            "schema": { "type": "integer" }
          },
          { "name": "sort", "in": "query", "schema": { "type": "string" } }
        ],
        "responses": { "200": { "description": "Paged" } }
      }
    },
    "/api/admin/staff": {
      "get": {
        "summary": "List staff",
        "parameters": [
          { "name": "page", "in": "query", "schema": { "type": "integer" } },
          {
            "name": "pageSize",
            "in": "query",
            "schema": { "type": "integer" }
          },
          { "name": "sort", "in": "query", "schema": { "type": "string" } }
        ],
        "responses": { "200": { "description": "Paged" } }
      }
    },
    "/api/admin/orders": {
      "get": {
        "summary": "List orders",
        "parameters": [
          {
            "name": "hostelCode",
            "in": "query",
            "schema": { "type": "string" }
          },
          {
            "name": "uniqueLaundryId",
            "in": "query",
            "schema": { "type": "string" }
          },
          { "name": "status", "in": "query", "schema": { "type": "string" } },
          {
            "name": "dateFrom",
            "in": "query",
            "schema": { "type": "string", "format": "date" }
          },
          {
            "name": "dateTo",
            "in": "query",
            "schema": { "type": "string", "format": "date" }
          },
          { "name": "page", "in": "query", "schema": { "type": "integer" } },
          {
            "name": "pageSize",
            "in": "query",
            "schema": { "type": "integer" }
          },
          { "name": "sort", "in": "query", "schema": { "type": "string" } }
        ],
        "responses": { "200": { "description": "Paged" } }
      }
    },

    "/api/orders": {
      "post": {
        "summary": "Create order",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["orderDate", "items"],
                "properties": {
                  "orderDate": { "type": "string" },
                  "items": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": ["itemType", "quantity"],
                      "properties": {
                        "itemType": { "type": "string" },
                        "quantity": { "type": "integer" },
                        "remark": { "type": "string" }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Order created" },
          "400": { "description": "Validation" }
        }
      },
      "get": {
        "summary": "List orders",
        "parameters": [
          { "name": "status", "in": "query", "schema": { "type": "string" } },
          { "name": "page", "in": "query", "schema": { "type": "integer" } },
          {
            "name": "pageSize",
            "in": "query",
            "schema": { "type": "integer" }
          },
          { "name": "sort", "in": "query", "schema": { "type": "string" } }
        ],
        "responses": { "200": { "description": "Paged" } }
      }
    },
    "/api/orders/{id}": {
      "get": {
        "summary": "Get order",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Order with items/images/qr/complaints" },
          "404": { "description": "Not found" }
        }
      }
    },
    "/api/orders/{id}/complete": {
      "post": {
        "summary": "Mark completed (PENDING → COMPLETED)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Completed" },
          "400": { "description": "Invalid transition" }
        }
      }
    },
    "/api/orders/{orderId}/items/{itemId}/images": {
      "post": {
        "summary": "Upload order item images (JSON array of base64/URLs)",
        "parameters": [
          {
            "name": "orderId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          },
          {
            "name": "itemId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["images"],
                "properties": {
                  "images": { "type": "array", "items": { "type": "string" } }
                }
              }
            }
          }
        },
        "responses": { "200": { "description": "Uploaded" } }
      }
    },
    "/api/orders/{id}/qrcode": {
      "get": {
        "summary": "Get QR payload",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": { "200": { "description": "QR payload" } }
      }
    },

    "/api/qr/scan": {
      "post": {
        "summary": "Scan QR → IN_PROGRESS",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["qrPayload"],
                "properties": { "qrPayload": { "type": "string" } }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "IN_PROGRESS" },
          "400": { "description": "Already scanned" },
          "404": { "description": "QR not found" }
        }
      }
    },
    "/api/qr/mark-pending/{orderId}": {
      "post": {
        "summary": "Mark order PENDING (IN_PROGRESS → PENDING)",
        "parameters": [
          {
            "name": "orderId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "PENDING" },
          "400": { "description": "Invalid transition" },
          "404": { "description": "Order not found" }
        }
      }
    },

    "/api/complaints/{orderId}": {
      "post": {
        "summary": "Create complaint for order (PENDING only)",
        "parameters": [
          {
            "name": "orderId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["description"],
                "properties": { "description": { "type": "string" } }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Complaint created" },
          "400": { "description": "Invalid" }
        }
      }
    },
    "/api/complaints": {
      "get": {
        "summary": "List complaints",
        "parameters": [
          { "name": "status", "in": "query", "schema": { "type": "string" } },
          { "name": "page", "in": "query", "schema": { "type": "integer" } },
          {
            "name": "pageSize",
            "in": "query",
            "schema": { "type": "integer" }
          },
          { "name": "sort", "in": "query", "schema": { "type": "string" } }
        ],
        "responses": { "200": { "description": "Paged" } }
      }
    },
    "/api/complaints/{id}": {
      "get": {
        "summary": "Get complaint",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Complaint with images" },
          "404": { "description": "Not found" }
        }
      }
    },
    "/api/complaints/{id}/images": {
      "post": {
        "summary": "Upload complaint images (JSON array of base64/URLs)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["images"],
                "properties": {
                  "images": { "type": "array", "items": { "type": "string" } }
                }
              }
            }
          }
        },
        "responses": { "200": { "description": "Uploaded" } }
      }
    },
    "/api/complaints/{id}/advance": {
      "post": {
        "summary": "Advance complaint (OPEN→IN_REVIEW→RESOLVED)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Advanced" },
          "400": { "description": "Invalid transition" }
        }
      }
    },
    "/api/complaints/{id}/close": {
      "post": {
        "summary": "Close complaint (RESOLVED→CLOSED)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": { "description": "Closed" },
          "400": { "description": "Only RESOLVED → CLOSED" }
        }
      }
    },

    "/api/notifications": {
      "get": {
        "summary": "List my notifications",
        "responses": { "200": { "description": "List" } }
      }
    },
    "/api/notifications/{id}/read": {
      "post": {
        "summary": "Mark notification read",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": { "200": { "description": "Read" } }
      }
    },

    "/api/dashboard/student": {
      "get": {
        "summary": "Student dashboard counts",
        "responses": { "200": { "description": "Counts" } }
      }
    },
    "/api/dashboard/staff": {
      "get": {
        "summary": "Staff dashboard counts",
        "responses": { "200": { "description": "Counts" } }
      }
    },
    "/api/dashboard/admin": {
      "get": {
        "summary": "Admin dashboard counts",
        "parameters": [
          {
            "name": "hostelCode",
            "in": "query",
            "schema": { "type": "string" }
          }
        ],
        "responses": { "200": { "description": "Counts" } }
      }
    },

    "/api/history/orders/{id}/history": {
      "get": {
        "summary": "Order history",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": { "200": { "description": "Status entries" } }
      }
    },
    "/api/history/complaints/{id}/history": {
      "get": {
        "summary": "Complaint history",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": { "200": { "description": "Status entries" } }
      }
    },

    "/api/orders/{id}/history": {
      "get": {
        "summary": "Order history (alias)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": { "200": { "description": "Status entries" } }
      }
    },
    "/api/complaints/{id}/history": {
      "get": {
        "summary": "Complaint history (alias)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" }
          }
        ],
        "responses": { "200": { "description": "Status entries" } }
      }
    }
  }
}
